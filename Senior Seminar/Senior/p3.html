<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>p3</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>


</head>

<body>

<div>
<span style="float: left;">CS 4900, Spring 2019</span>
<span style="float: right;">Dr. Zhiguang Xu</span>
</div>

<p style='clear: left;'></p>

<p><br></p>

<h2 id="toc_0">Project 3: Depot Task D, Starting to Convert the Depot Catalog Page to an SPA with ReactJS, and More</h2>

<h3 id="toc_1">Due: Feburary 7, 2019</h3>

<h3 id="toc_2">1. Introduction</h3>

<p>This project continues the development of “Depot” with Rails and ReactJS. After working on the the backend of the application a little bit further, we will also start to build a new version of the catalog page as a <strong>Single Page Application</strong> (SPA) where book listing, sorting, filtering, and searching are all implemented as ReactJS <em>Components</em> in one Web page. </p>

<blockquote>
<p>Later, components for rendering shopping cart and even capturing an order are all going to be included on this SPA page, where techniques such as React Router has to be used.</p>

<p><strong>GIT ALERT</strong>: <span style="color:red"> <strong>For this entire project, you must strictly follow the &quot;Git work flow&quot; on page 14 of the &quot;Git Crash Course&quot;!</strong></span></p>
</blockquote>

<h3 id="toc_3">2.   Project Specifications - Part I, Backend</h3>

<h4 id="toc_4">2.1. Go to “Part II: Building an Application” in the “<em>Rails Book</em>”.</h4>

<ul>
<li><p>Complete all the steps <span style="color:red"> <strong>EXCEPT those ones pertaining to testing</strong></span> in <strong>Task D</strong>.</p>

<p>One bug has to be fixed though.</p>

<ul>
<li>Add one of the products in a cart then try to destoy that product. Although the product won&#39;t be mistakenly destroyed thanks to the <code>ensure_not_referenced_by_any_line_item</code> method that you added to the <code>Product</code> model, the flash notice still says &quot;Product was successfully destroyed.&quot;. That is not right so <strong>fix this bug.</strong></li>
</ul>

<blockquote>
<p>To clear and then repopulate all your database tables (if you need to), run the command <code>rails db:reset</code> then <code>rails db:seed</code>. </p>
</blockquote></li>
<li><p>On the side bar, add a new quick-link “My Shopping Cart” that links to the current Shopping Cart page. Correspondingly, add a “Back to Catalog” link at the end of the Shopping Cart page so you can go back. </p>

<ul>
<li>Don&#39;t let the “My Shopping Cart” quick link to lead you to a page that shows all shopping carts though. </li>
<li>Also, make sure the “My Shopping Cart” quick-link does not show on any of the &quot;<em>/products</em>&quot; pages though because such pages are only for the book sellers who typically don&#39;t have their shopping carts. </li>
</ul></li>
<li><p>Complete the &quot;Playtime” tasks on page 132 at the end of Task D. Please display the counter message only after the user has visited the catalog page more than 5 times without putting any book in his/her shopping cart.</p>

<ul>
<li>You will find two helpers, <code>flash</code> and <code>pluralize</code>,  very useful when implementing this feature. Google them!</li>
</ul></li>
<li><p>Popularity-based sorting</p>

<p>Add an additional <code>popularity</code> field in the <code>products</code> table so as to keep track of how many times such a book has been put in someone(anyone)’s shopping cart. Obviously, the larger is such a field, the more popular is that book. The books on the catalog page then need to be sorted based on their popularity by default. </p>

<p><span style="color:red"> <strong>Warning: This part tests your understanding of MVC in Rails that you&#39;ve learned so far. See some hints in section 2.2 below.</strong></span> </p></li>
</ul>

<h4 id="toc_5">2.2. Hints for the &quot;Popularity&quot; Feature Above</h4>

<p>The following command creates a migrate file that will add one new decimal field <code>popularity</code> to the table <code>products</code>:</p>

<div><pre><code class="language-none">rails g migration add_popularity_to_product popularity:decimal</code></pre></div>

<p>In the migrate file generated by the command above, add <code>, default: 0</code> at the end of the line of <code>add_column</code>. Then of course you need to rake this migrate to actually update the database table. Note, if for some reason, the <code>rails db:migrate</code> command fails, all you need to do is rollback and re-rake the migrate. The worst-case scenario is that you have to delete the entire database <code>db/development.sqlite3</code> all together and re-rake all migrates from the beginning.</p>

<p>In order to update the <code>popularity</code> of a <code>product</code> in the <code>products</code> table, you will find that the <code>update_attribute()</code> method comes in handy. For instance, assume you have a variable <code>product</code> whose <code>popularity</code> attribute needs to be increased by 1, you may do the following:</p>

<div><pre><code class="language-none">product.popularity = product.popularity + 1
product.update_attribute(:popularity, product.popularity)</code></pre></div>

<p>Also, when you test your code, chances are you will mess up some of the database tables. When that happens and you need to bring the tables back to sanity (e.g. you need to reset the quantity of a lineitem to 0), you will find the <a href="https://sqlitebrowser.org/">DB Browser for SQLite</a> tool an invaluable tool to have.</p>

<h3 id="toc_6">3.   Project Specifications - Part II, Frontend</h3>

<p>In this part, we&#39;re going to learn how to integrate ReactJS into an <span style="color:orange"><strong>existing</strong></span> Rails app. </p>

<h4 id="toc_7">3.1 A Few Words on ReactJS</h4>

<p>React is known as a JavaScript framework that </p>

<ul>
<li>promotes events and data to be <strong>one directional</strong>, constraining your development process in a good way</li>
<li>centers around simple concepts of &quot;<em>props</em>&quot; and &quot;<em>states</em>&quot; -- read <a href="https://github.com/uberVU/react-guide/blob/master/props-vs-state.md">this good article on the differences between them</a></li>
<li>leverages the virtual DOM for high performance</li>
<li>promotes componentized development</li>
<li>and is just a view layer helping to make it more modular and efficient</li>
</ul>

<p>Out of many online tutorials on React, Redux, and related subjects, <a href="https://facebook.github.io/react/">the official API documentation site</a> turns out to be the best. </p>

<blockquote>
<p>A sidenote:</p>

<p>In this past fall (fall 2018), I taught CS 4990 &quot;Special Topics in CS&quot; as a pilot course covering <strong>FullStack Web Development on React, Redux, MongoDB, Express, NodeJS, and more</strong>. In this coming fall, I am going to offer CS 4840, a dedicated course on modern and advanced web development technologies. Welcome to sign up.</p>
</blockquote>

<h4 id="toc_8">3.2 Integrate ReactJS to an Existing Project &quot;Depot&quot;</h4>

<ul>
<li><p>Add the following line to <code>Gemfile</code>:</p>

<div><pre><code class="language-none">gem &#39;webpacker&#39;</code></pre></div></li>
<li><p>Run the following commands to install React and all the dependencies, change configuration files, and create a new <code>app/javascript/packs</code> directory from where Webpack will compile any Javascript or CSS, including React components.</p>

<div><pre><code class="language-none">bundle install
rails webpacker:install
rails webpacker:install:react</code></pre></div></li>
<li><p><strong>Remove</strong> the following line from <code>app/assets/javascripts/application.js</code>:</p>

<div><pre><code class="language-none">//= require turbolinks</code></pre></div></li>
<li><p>Update the following line in <code>config/environments/development.rb</code>:</p>

<div><pre><code class="language-none">config.webpacker.check_yarn_integrity = false</code></pre></div></li>
<li><p>Restart the Rails server</p></li>
</ul>

<h4 id="toc_9">3.3 Instant Gratification</h4>

<p>Let&#39;s give it a quick test. </p>

<p>Update the following two files such that on the top of the catalog page, the number of products is rendered by React (as shown in the screenshot below).</p>

<ul>
<li><code>app/views/store/index.html.erb</code> (the Rails view file for displaying the catalog page)</li>
<li><code>app/javascript/packs/hello_react.jsx</code> (the toy component automatically created by the last command <code>rails webpacker:install:react</code> that you ran above.</li>
</ul>

<p><img src="./instant_react.png" alt="./instant_react.png"></p>

<p><span style="color:red"><strong>Warning:</strong></span> You can&#39;t proceed to the next section without completing this one.</p>

<h4 id="toc_10">3.4 Hot-reloading in React</h4>

<p>As you learned in Project 1, Rails 5.1+ comes with the fantastic <code>webpack-dev-server</code> which allows &quot;hot-reloading&quot;, i.e., it will analyse changes in our <code>app/javascript</code> folder and rebuild the frontend on the fly.</p>

<blockquote>
<p>Unfortunately, on AWS cloud 9, I am running out of time figuring out how to make &quot;hot reloading&quot; to work. So, if you are an AWS Cloud9 user, only run one server which is the Rails server. And when you need to test your React code, just refresh the browser.</p>
</blockquote>

<ul>
<li><p>Run the following command to install <code>foreman</code>, a tool that allows us to run two processes simultaneously: <code>rails s</code> you all know and love and <code>webpack-dev-server</code>.</p>

<div><pre><code class="language-none">gem install foreman</code></pre></div></li>
<li><p>Under the root folder of the <code>demo</code> project, create a new file <code>Procfile.dev</code> and add the following two lines into it, one for starting the Rails server and the other for starting the webpack server:</p>

<div><pre><code class="language-none">web: bundle exec rails s
webpacker: ./bin/webpack-dev-server</code></pre></div></li>
<li><p>Finally, start both Rails and webpack servers:</p>

<div><pre><code class="language-none">foreman start -f Procfile.dev -p 3000</code></pre></div>

<p>Test the application at <code>localhost:3000</code> in the browser and use the React Developer Tools to check how wonderful hot-reloading is.</p></li>
<li><p>Git Alert</p></li>
</ul>

<h4 id="toc_11">3.5 Start to Build the Catalog SPA</h4>

<p>In the previous couple of sections, we used <code>hello_react.jsx</code> to ensure that our React-based frontend can be properly integrated with our Rails-based backend. Of course, you don&#39;t want to stick with this toy component for the rest of this app. So let&#39;s clear the house before moving on:</p>

<ul>
<li><p>Remove both <code>application.js</code> and <code>hello_react.jsx</code> files from the <code>app/javascript/packs</code> folder since we don&#39;t need either of them anymore.</p></li>
<li><p>Remove the <code>content_tag</code> that you added into <code>app/views/store/index.html.erb</code>. It was only there fore &quot;instant gratification&quot; so we don&#39;t need it either.</p></li>
</ul>

<p>Okay, now, here is the plan: we are going to build two catalogs (same contents though) on two seprate pages - one Rails view-based producing regular HTML and Javascript (like what we did in Part I above and we are going to continue to work on it) and one ReactJS-baed SPA producing JSON. For now, the SPA version of the catalog will simply display the number of books in the catalog. It apparently will be enriched in the next Tasks.</p>

<blockquote>
<p>Of course, on the frontend of a <strong>real-world</strong> app, you don&#39;t need two versions for the same web page. We are building <code>Depot</code> here as a training project and that is why I want to expose you to both.</p>
</blockquote>

<p>So, let&#39;s do this.</p>

<ul>
<li><p>In <code>app/views/layouts/application.erb</code>, replace the &quot;Home&quot; quick link with the following:</p>

<div><pre><code class="language-none">&lt;li&gt;&lt;%= link_to &quot;Home&quot;, store_index_path(spa: false) %&gt;&lt;/li&gt;            
&lt;li&gt;&lt;%= link_to &quot;Home (SPA)&quot;, store_index_path(spa: true) %&gt;&lt;/li&gt;</code></pre></div>

<p>As you can see, the HTML request sent from both of these two quick links are going to be handled by the same method in the same controller (i.e. <code>store#index</code>), however, the parameter <code>spa</code> that they carry is different, one false and one true. Then in <code>store#index</code>, different view files will be rendered accordingly. See below.</p></li>
<li><p>At the end of the <code>index</code> method in <code>app/controllers/store_controller.rb</code>, add the following block:</p>

<div><pre><code class="language-none">    ...
    respond_to do |format|
        format.html {
            if (params[:spa] &amp;&amp; params[:spa] == &quot;true&quot;)
                render &#39;index_spa&#39;
            # the else case below is by default
            else
               render &#39;index&#39;
            end
        }
        format.json {render json: @products}
    end
    ...</code></pre></div>

<p><strong>Another very important change</strong> to the <code>StoreController</code> above is the <code>format.json {render json: @products}</code> statement. Such a statement sends back all the books on the catalog in the form of JSON to the client (which is going to be a React-based SPA) upon receiving an ajaxified request from it. More discussions on this later.</p></li>
<li><p>Next, create a new view file <code>index_spa.html.erb</code> (see below) in the folder of <code>app/views/store</code>. </p>

<div><pre><code class="language-none">&lt;% if notice %&gt;
    &lt;aside id=&quot;notice&quot;&gt;&lt;%= notice %&gt;&lt;/aside&gt;
&lt;% end %&gt;

&lt;%= content_tag :div,
    id: &quot;catalog&quot;  do %&gt;

    &lt;%= javascript_pack_tag &#39;catalog&#39; %&gt;
&lt;% end %&gt;</code></pre></div>

<p>Such a file serves as <span style="color:green">the entry point</span> to the React Components (in this case, <code>Catalog</code>). Notice that unlike what we did in the <code>Hello</code> component above, we are not passing books as React props to <code>Catalog</code>, instead, the component will fetch them &quot;asynchronously&quot;. More discussions on this later.</p></li>
<li><p>Switching to the React world now.</p>

<ul>
<li><p>Run the following command to install <code>axios</code> - a React Promise based HTTP communication client for the browser and node.js.</p>

<div><pre><code class="language-none">yarn add axios</code></pre></div></li>
<li><p>Next, let&#39;s organize the folder structure in the <code>app/javascript</code> folder like what we did in Project 1:</p>

<ul>
<li>app/javascript/

<ul>
<li>catalog/

<ul>
<li>components/

<ul>
<li>Catalog.jsx</li>
</ul></li>
<li>index.js</li>
</ul></li>
<li>packs/

<ul>
<li>catalog.jsx</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>Then compose the following three files:</p>

<p><code>app/javascript/packs/catalog.jsx</code>:</p>

<div><pre><code class="language-none">import &quot;catalog&quot;; // This imnplies to use app/javascript/catalog/index.js
</code></pre></div>

<p><code>app/javascript/catalog/index.js</code>:</p>

<div><pre><code class="language-none">import React from &quot;react&quot;;
import ReactDOM from &quot;react-dom&quot;;
import Catalog from &quot;./components/Catalog&quot;;

document.addEventListener(&quot;DOMContentLoaded&quot;, () =&gt; {
    const catalog = document.querySelector(&quot;#catalog&quot;);
    ReactDOM.render(&lt;Catalog /&gt;, catalog);
});
</code></pre></div>

<p><code>app/javascript/catalog/components/Catalog.jsx</code>:</p>

<div><pre><code class="language-none">import React from &#39;react&#39;;
import axios from &#39;axios&#39;;

export default class Catalog extends React.Component {

    state = { books: [] };

    componentDidMount = () =&gt; {
        var self = this;

        axios.defaults.headers.common[&#39;X-Requested-With&#39;] = &quot;XMLHttpRequest&quot;;
        axios.get(&#39;/&#39;)
            .then(function (response) {
                console.log(response.data);
                self.setState({ books: response.data })
            })
            .catch(function (error) {
                console.log(error);
            });
    };  

    render = () =&gt; {
        return(
            &lt;div&gt;
                &lt;h3&gt;
                    There are {this.state.books.length} books in the catalog.
                &lt;/h3&gt;
            &lt;/div&gt;
        );
    };
}   </code></pre></div></li>
</ul>

<p>Here is what is going to happen:</p>

<p>Using axios (see above), the <code>Catalog</code> component sends a special &quot;Ajaxified&quot; HTTP request to the server without block-waiting for the response to come back. Upon receiving such a request, the Rails server collects the data and sends it back as a &quot;json&quot; message (see the line <code>format.json {render json: @products}</code> in <code>app/controllers/store_controller.rb</code>). When such a &quot;json&quot; message arrives at the client, a callback function (technically, it is called a JavaScript Promise) will be called to handle it -- basically, populating the <code>books</code> state in <code>Catalog</code> and rendering it in the browser.</p></li>
<li><p>Restart the servers by running <code>foreman start -f Procfile.dev -p 3000</code>. Check out the Depot app on your browser. </p>

<blockquote>
<p>If you look close to the Chrome Dev Tools, you should notice that we&#39;ve already fetched all the books themselves (not just the number of them) back from the server and store them in the React state <code>books</code>. </p>

<p>But I think we&#39;ve done quite a lot in this project and would like to call it.</p>
</blockquote></li>
<li><p>Git alert</p></li>
</ul>

<h3 id="toc_12">4.   Project Deployment to Heroku</h3>

<p>First, remove the alias <code>heroku</code> that you made in project 2.</p>

<div><pre><code class="language-none">git remote rm heroku</code></pre></div>

<p>Then the steps it takes to deploy your Depot application to Heroku are all the same as what you did in section 3.3. of Project 2 except that the name of your app on Heroku should be <strong><code>project3-yourfirstname-yourlastname</code></strong>.</p>

<h3 id="toc_13">6.   What to Turn in?</h3>

<ul>
<li><p>Final version of the project source code pushed onto Github</p>

<p><span style="color:red">Alert: <strong>Don&#39;t push your P3 to the master branch onto your Github repository  until I explicitly tell you so on BlazeVIEW</strong>. I need to pull your Project 2 down for grading purposes first before you overwrite it with the code for this Project 3.</span></p></li>
<li><p>Final version of the project deployed on Heroku. You must name your application on Heroku:</p>

<div><pre><code class="language-none">http://project3-yourfirstname-yourlastname.herokuapp.com</code></pre></div></li>
<li><p>The Git log file reflecting the full history of your project submitted on BlazeVIEW</p></li>
</ul>




</body>

</html>
